<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MADRID 2035: Manual Civil Extendido</title>
    <meta name="description" content="Base de conocimiento y protocolos civiles para Madrid 2035.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">

    <style>
        :root {
            --bg-app: #0f172a;
            /* Slate 900 */
            --bg-card: #1e293b;
            /* Slate 800 */
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --accent: #38bdf8;
            /* Sky 400 */
        }

        body {
            background-color: var(--bg-app);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .article-card {
            transition: all 0.2s ease;
        }

        .article-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            border-color: var(--accent);
        }

        /* Typography for Article Content */
        .prose h3 {
            color: #38bdf8;
            font-weight: 700;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-size: 1.25rem;
        }

        .prose h4 {
            color: #94a3b8;
            font-weight: 600;
            margin-top: 1.2em;
            margin-bottom: 0.5em;
            font-size: 1.1rem;
        }

        .prose p {
            margin-bottom: 1em;
            line-height: 1.7;
            color: #cbd5e1;
        }

        .prose ul,
        .prose ol {
            margin-bottom: 1em;
            padding-left: 1.5em;
            list-style-type: disc;
            color: #cbd5e1;
        }

        .prose li {
            margin-bottom: 0.5em;
        }

        .prose strong {
            color: #fff;
            font-weight: 600;
        }

        .prose .warning-box {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.25rem;
        }

        .prose .info-box {
            background: rgba(56, 189, 248, 0.1);
            border-left: 4px solid #38bdf8;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.25rem;
        }

        .category-chip.active {
            background-color: var(--accent);
            color: #0f172a;
            border-color: var(--accent);
        }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden">

    <!-- HEADER SIMPLE -->
    <header class="bg-slate-900 border-b border-slate-800 p-4 shrink-0 z-20 shadow-md">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <i class="fa-solid fa-book-journal-whills text-2xl text-sky-400"></i>
                <div>
                    <h1 class="font-bold text-lg leading-none tracking-tight">MADRID 2035</h1>
                    <p class="text-xs text-slate-400 font-mono">MANUAL DE REFERENCIA CIVIL V2.0</p>
                </div>
            </div>
            <!-- Bot√≥n Info/About -->
            <div class="flex space-x-2">
                <a href="tools.html" class="text-sky-400 hover:text-white transition-colors"
                    title="Herramientas y Juegos">
                    <i class="fa-solid fa-toolbox text-xl"></i>
                </a>
                <button onclick="toggleAbout()" class="text-slate-400 hover:text-white">
                    <i class="fa-solid fa-circle-info text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- SEARCH & FILTERS -->
    <div class="bg-slate-900/95 border-b border-slate-800 p-4 shrink-0 z-10">
        <div class="max-w-4xl mx-auto space-y-4">
            <!-- Search Bar -->
            <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-3 text-slate-500"></i>
                <input type="text" id="search-input" placeholder="Buscar protocolos, rutas, suministros..."
                    class="w-full bg-slate-800 border border-slate-700 text-white pl-10 pr-4 py-2 rounded-lg focus:outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500 placeholder-slate-500 transition-all">
            </div>

            <!-- Category Chips -->
            <div class="flex space-x-2 overflow-x-auto no-scrollbar pb-1" id="category-filters">
                <button onclick="filterContent('all')"
                    class="category-chip active whitespace-nowrap px-4 py-1.5 rounded-full border border-slate-700 text-sm font-medium transition-colors"
                    data-cat="all">Todo</button>
                <button onclick="filterContent('emergencia')"
                    class="category-chip whitespace-nowrap px-4 py-1.5 rounded-full border border-slate-700 text-sm font-medium transition-colors hover:bg-slate-800"
                    data-cat="emergencia">üö® Emergencia</button>
                <button onclick="filterContent('logistica')"
                    class="category-chip whitespace-nowrap px-4 py-1.5 rounded-full border border-slate-700 text-sm font-medium transition-colors hover:bg-slate-800"
                    data-cat="logistica">üì¶ Log√≠stica</button>
                <button onclick="filterContent('geografia')"
                    class="category-chip whitespace-nowrap px-4 py-1.5 rounded-full border border-slate-700 text-sm font-medium transition-colors hover:bg-slate-800"
                    data-cat="geografia">üó∫Ô∏è Mapas</button>
                <button onclick="filterContent('salud')"
                    class="category-chip whitespace-nowrap px-4 py-1.5 rounded-full border border-slate-700 text-sm font-medium transition-colors hover:bg-slate-800"
                    data-cat="salud">üè• Salud</button>
                <button onclick="filterContent('herramientas')"
                    class="category-chip whitespace-nowrap px-4 py-1.5 rounded-full border border-slate-700 text-sm font-medium transition-colors hover:bg-slate-800"
                    data-cat="herramientas">üõ†Ô∏è Herramientas</button>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT GRID -->
    <main class="flex-grow overflow-y-auto bg-slate-950 p-4" id="main-scroll">
        <div class="max-w-4xl mx-auto">
            <div id="articles-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-8">
                <!-- Art√≠culos inyectados por JS -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="hidden text-center py-12">
                <i class="fa-solid fa-folder-open text-4xl text-slate-700 mb-4"></i>
                <p class="text-slate-500">No se encontraron resultados.</p>
            </div>
        </div>
    </main>

    <!-- ARTICLE READER (Modal Fullscreen) -->
    <div id="article-reader" class="hidden fixed inset-0 z-50 bg-slate-900 flex flex-col animate-fade-in">
        <!-- Reader Header -->
        <div
            class="border-b border-slate-800 bg-slate-900/95 backdrop-blur p-4 flex items-center justify-between shrink-0">
            <button onclick="closeReader()" class="flex items-center text-slate-400 hover:text-white transition-colors">
                <i class="fa-solid fa-arrow-left mr-2"></i> Volver
            </button>
            <div class="flex space-x-4 text-slate-400">
                <button onclick="adjustFontSize(1)" title="Aumentar Texto"><i
                        class="fa-solid fa-font text-sm"></i>+</button>
                <button onclick="adjustFontSize(-1)" title="Disminuir Texto"><i
                        class="fa-solid fa-font text-xs"></i>-</button>
            </div>
        </div>

        <!-- Reader Content -->
        <div class="flex-grow overflow-y-auto p-4 md:p-8" id="reader-scroll">
            <article class="max-w-3xl mx-auto prose prose-invert pb-24">
                <div class="mb-8">
                    <span id="reader-category"
                        class="text-sky-400 text-xs font-bold uppercase tracking-wider mb-2 block">CATEGOR√çA</span>
                    <h1 id="reader-title" class="text-3xl md:text-4xl font-bold text-white leading-tight">T√≠tulo del
                        Art√≠culo</h1>
                </div>
                <div id="reader-body" class="text-slate-300">
                    <!-- Contenido -->
                </div>
            </article>
        </div>
    </div>

    <!-- ABOUT MODAL -->
    <div id="about-modal"
        class="hidden fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-xl max-w-sm w-full p-6 border border-slate-700 shadow-2xl">
            <h2 class="text-xl font-bold text-white mb-2">Sobre esta Web</h2>
            <p class="text-slate-300 text-sm mb-4">Esta es una herramienta de consulta offline. Toda la informaci√≥n est√°
                contenida en este archivo HTML. No env√≠a datos a internet.</p>
            <button onclick="toggleAbout()"
                class="w-full bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg font-medium transition-colors">Entendido</button>
        </div>
    </div>

    <script src="articles.js"></script>
    <script>
        // --- BASE DE DATOS DE ART√çCULOS ---
        // Loaded from articles.js

        // --- FUNCIONES DE INTERFAZ (Misma l√≥gica, solo carga los nuevos datos) ---
        const articlesGrid = document.getElementById('articles-grid');
        const emptyState = document.getElementById('empty-state');
        const searchInput = document.getElementById('search-input');

        let currentFilter = 'all';

        function renderArticles(filterText = '') {
            articlesGrid.innerHTML = '';
            let count = 0;

            const normalizedText = filterText.toLowerCase();

            articles.forEach(article => {
                if (currentFilter !== 'all' && article.category !== currentFilter) return;

                if (normalizedText &&
                    !article.title.toLowerCase().includes(normalizedText) &&
                    !article.content.toLowerCase().includes(normalizedText) &&
                    !article.summary.toLowerCase().includes(normalizedText)) {
                    return;
                }

                count++;
                const card = document.createElement('div');
                card.className = 'article-card bg-slate-800 border border-slate-700 p-5 rounded-xl cursor-pointer flex flex-col justify-between h-full';
                card.onclick = () => openReader(article);

                let catColor = 'text-slate-400';
                if (article.category === 'emergencia') catColor = 'text-pink-500';
                if (article.category === 'logistica') catColor = 'text-amber-500';
                if (article.category === 'geografia') catColor = 'text-sky-500';
                if (article.category === 'herramientas') catColor = 'text-violet-500';


                card.innerHTML = `
                    <div>
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-[10px] font-bold uppercase tracking-widest text-slate-500 border border-slate-700 px-2 py-0.5 rounded bg-slate-900">${article.category}</span>
                            <i class="fa-solid ${article.icon} ${catColor} text-lg"></i>
                        </div>
                        <h3 class="text-lg font-bold text-white mb-2 leading-snug">${article.title}</h3>
                        <p class="text-sm text-slate-400 leading-relaxed">${article.summary}</p>
                    </div>
                    <div class="mt-4 flex items-center text-sky-500 text-xs font-semibold group">
                        Leer gu√≠a completa <i class="fa-solid fa-arrow-right ml-1 transition-transform group-hover:translate-x-1"></i>
                    </div>
                `;
                articlesGrid.appendChild(card);
            });

            if (count === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
            }
        }

        function filterContent(category) {
            currentFilter = category;
            document.querySelectorAll('.category-chip').forEach(btn => {
                if (btn.dataset.cat === category) {
                    btn.classList.add('active');
                    btn.classList.remove('hover:bg-slate-800');
                } else {
                    btn.classList.remove('active');
                    btn.classList.add('hover:bg-slate-800');
                }
            });
            renderArticles(searchInput.value);
        }

        searchInput.addEventListener('input', (e) => {
            renderArticles(e.target.value);
        });

        function openReader(article) {
            const reader = document.getElementById('article-reader');
            document.getElementById('reader-title').innerText = article.title;
            document.getElementById('reader-category').innerText = article.category;
            document.getElementById('reader-body').innerHTML = article.content;
            reader.classList.remove('hidden');
            document.getElementById('reader-scroll').scrollTop = 0;
        }

        function closeReader() {
            document.getElementById('article-reader').classList.add('hidden');
        }

        let currentFontSize = 100;
        function adjustFontSize(dir) {
            const body = document.getElementById('reader-body');
            currentFontSize += (dir * 10);
            if (currentFontSize < 80) currentFontSize = 80;
            if (currentFontSize > 150) currentFontSize = 150;
            body.style.fontSize = `${currentFontSize}%`;
        }

        function toggleAbout() {
            const modal = document.getElementById('about-modal');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
            } else {
                modal.classList.add('hidden');
            }
        }

        renderArticles();
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registrado', reg))
                    .catch(err => console.log('SW error', err));
            });
        }
    </script>
</body>

</html>